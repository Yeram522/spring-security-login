<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë³´ì•ˆ ê´€ì œì„¼í„°</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ê³¼ ë™ì¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: bold;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .connection-status.connecting {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }

        .connection-status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .connection-status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-toast {
            position: fixed;
            top: 60px;
            right: 10px;
            min-width: 350px;
            max-width: 500px;
            background: white;
            border-left: 4px solid #007bff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 16px;
            margin-bottom: 10px;
            z-index: 1001;
            animation: slideIn 0.3s ease-out;
        }

        .alert-toast.severity-critical {
            border-left-color: #dc3545;
            background: #fff5f5;
        }

        .alert-toast.severity-high {
            border-left-color: #fd7e14;
            background: #fff8f0;
        }

        .alert-toast.severity-medium {
            border-left-color: #ffc107;
            background: #fffbf0;
        }

        .alert-toast.severity-low {
            border-left-color: #28a745;
            background: #f0fff4;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .alert-time {
            font-size: 0.85em;
            color: #666;
        }

        .alert-body {
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .alert-actions {
            display: flex;
            gap: 8px;
        }

        .alert-actions button {
            padding: 4px 12px;
            border: 1px solid #ddd;
            border-radius: 3px;
            background: white;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .alert-actions button:hover {
            background: #f8f9fa;
        }

        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.5s ease;
        }

        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2em;
            text-align: center;
            margin-bottom: 15px;
        }

        .status-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .status-item.online {
            background: #d4edda;
            color: #155724;
        }

        .status-item.warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-item.critical {
            background: #f8d7da;
            color: #721c24;
        }

        .status-item.info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .controls button {
            padding: 8px 16px;
            border: 1px solid #007bff;
            background: #007bff;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .controls button:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        .controls button.secondary {
            background: white;
            color: #007bff;
        }

        .controls button.secondary:hover {
            background: #f8f9fa;
        }

        .dashboard {
            padding: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .metric::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .metric.critical {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
        }

        .metric.critical::before {
            background: #f44336;
        }

        .metric.warning {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
        }

        .metric.warning::before {
            background: #ff9800;
        }

        .metric.normal {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
        }

        .metric.normal::before {
            background: #4caf50;
        }

        .metric.info {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
        }

        .metric.info::before {
            background: #2196f3;
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .metric-label {
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 15px;
        }

        .threat-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .threat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #dc3545;
            transition: all 0.3s ease;
        }

        .threat-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .threat-ip {
            font-family: monospace;
            font-weight: bold;
            color: #dc3545;
        }

        .threat-count {
            background: #dc3545;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }

        .update-time {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .metric.critical .metric-value {
            animation: pulse 2s infinite;
            color: #d32f2f;
        }
    </style>
</head>
<body>
<div id="app">
    <!-- ì—°ê²° ìƒíƒœ í‘œì‹œ -->
    <div :class="['connection-status', connectionStatus]">
        {{ connectionStatusText }}
    </div>

    <!-- í—¤ë” -->
    <div class="header">
        <h1>ğŸ›¡ï¸ ë³´ì•ˆ ê´€ì œì„¼í„°</h1>
        <div class="status-bar">
            <div class="status-item online">
                <span>ğŸŸ¢</span> ì‹œìŠ¤í…œ ì •ìƒ
            </div>
            <div class="status-item warning">
                <span>ğŸŸ¡</span> {{ metrics.warningCount || 0 }}ê°œ ê²½ê³ 
            </div>
            <div class="status-item critical">
                <span>ğŸ”´</span> {{ metrics.criticalAlerts || 0 }}ê°œ ê¸´ê¸‰
            </div>
            <div class="status-item info">
                <span>ğŸ“Š</span> ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
            </div>
        </div>

        <div class="controls">
            <button @click="refreshAllData">
                ğŸ”„ ì „ì²´ ìƒˆë¡œê³ ì¹¨
            </button>
            <button @click="testAlert" class="secondary">
                ğŸ§ª í…ŒìŠ¤íŠ¸ ì•Œë¦¼
            </button>
            <button @click="exportReport" class="secondary">
                ğŸ“Š ë¦¬í¬íŠ¸ ë‚´ë³´ë‚´ê¸°
            </button>
            <select v-model="selectedTimeRange" @change="updateTimeRange">
                <option value="15m">ìµœê·¼ 15ë¶„</option>
                <option value="1h">ìµœê·¼ 1ì‹œê°„</option>
                <option value="24h">ìµœê·¼ 24ì‹œê°„</option>
                <option value="7d">ìµœê·¼ 7ì¼</option>
            </select>
        </div>
    </div>

    <!-- ëŒ€ì‹œë³´ë“œ -->
    <div class="dashboard">
        <!-- ì‹¤ì‹œê°„ ë³´ì•ˆ ì§€í‘œ -->
        <div class="card">
            <h3>ğŸ“Š ì‹¤ì‹œê°„ ë³´ì•ˆ ì§€í‘œ</h3>
            <div class="metrics-grid">
                <div class="metric critical">
                    <div class="metric-value">{{ metrics.criticalAlerts || 0 }}</div>
                    <div class="metric-label">ê¸´ê¸‰ ì•Œë¦¼</div>
                </div>
                <div class="metric warning">
                    <div class="metric-value">{{ metrics.blockedIps || 0 }}</div>
                    <div class="metric-label">ì°¨ë‹¨ëœ IP</div>
                </div>
                <div class="metric normal">
                    <div class="metric-value">{{ formatNumber(metrics.successfulLogins || 0) }}</div>
                    <div class="metric-label">ì •ìƒ ë¡œê·¸ì¸</div>
                </div>
                <div class="metric info">
                    <div class="metric-value">{{ formatNumber(metrics.totalRequests || 0) }}</div>
                    <div class="metric-label">ì´ ìš”ì²­ ìˆ˜</div>
                </div>
            </div>
        </div>

        <!-- ì‹¤ì‹œê°„ ë³´ì•ˆ ì´ë²¤íŠ¸ ì¶”ì´ -->
        <div class="card">
            <h3>ğŸ“ˆ ì‹¤ì‹œê°„ ë³´ì•ˆ ì´ë²¤íŠ¸ ì¶”ì´</h3>
            <div class="chart-container">
                <canvas id="realTimeChart"></canvas>
            </div>
        </div>

        <!-- ìƒìœ„ ìœ„í˜‘ IP -->
        <div class="card">
            <h3>ğŸŒ ìƒìœ„ ìœ„í˜‘ IP TOP 10</h3>
            <div class="threat-list">
                <div v-for="threat in threatIps" :key="threat.ipAddress" class="threat-item"
                     :style="{ borderLeftColor: getThreatColor(threat.riskLevel) }">
                    <div>
                        <div class="threat-ip">{{ threat.ipAddress }}</div>
                        <small style="color: #666;">
                            ğŸŒ {{ threat.countryCode }} | {{ threat.attackTypes.join(', ') }}
                        </small>
                    </div>
                    <div class="threat-count" :style="{ background: getThreatColor(threat.riskLevel) }">
                        {{ threat.attackCount }}
                    </div>
                </div>
            </div>
        </div>

        <!-- ì‹œê°„ëŒ€ë³„ ê³µê²© íŒ¨í„´ -->
        <div class="card">
            <h3>â° ì‹œê°„ëŒ€ë³„ ê³µê²© íŒ¨í„´</h3>
            <div class="chart-container">
                <canvas id="hourlyChart"></canvas>
            </div>
        </div>

        <!-- ì‘ë‹µì‹œê°„ ëª¨ë‹ˆí„°ë§ -->
        <div class="card">
            <h3>âš¡ ì‹œìŠ¤í…œ ì‘ë‹µì‹œê°„ ëª¨ë‹ˆí„°ë§</h3>
            <div class="chart-container">
                <canvas id="responseTimeChart"></canvas>
            </div>
        </div>
    </div>

    <!-- ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ -->
    <div class="update-time">
        ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: {{ lastUpdateTime }}
    </div>

    <!-- ì•Œë¦¼ í† ìŠ¤íŠ¸ë“¤ -->
    <transition-group name="fade">
        <div v-for="alert in alerts" :key="alert.id"
             :class="['alert-toast', `severity-${alert.severity.toLowerCase()}`]">
            <div class="alert-header">
                <strong>{{ alert.title }}</strong>
                <span class="alert-time">{{ formatTime(alert.timestamp) }}</span>
            </div>
            <div class="alert-body" v-html="alert.message.replace(/\n/g, '<br>')"></div>
            <div class="alert-actions">
                <button @click="acknowledgeAlert(alert)">âœ… í™•ì¸</button>
                <button @click="suppressAlert(alert, 1)">ğŸ”‡ 1ì‹œê°„ ì–µì œ</button>
                <button v-if="alert.ipAddress && alert.ipAddress !== 'multiple_ips'"
                        @click="blockIp(alert.ipAddress)">ğŸš« IP ì°¨ë‹¨
                </button>
                <button @click="removeAlert(alert.id)">âŒ ë‹«ê¸°</button>
            </div>
        </div>
    </transition-group>
</div>

<script>
    const {createApp, ref, reactive, onMounted, onUnmounted, nextTick} = Vue;

    createApp({
        setup() {
            // ë°˜ì‘í˜• ë°ì´í„°
            const connectionStatus = ref('connecting');
            const connectionStatusText = ref('ğŸ”„ ì—°ê²° ì¤‘...');
            const selectedTimeRange = ref('1h');
            const lastUpdateTime = ref('--:--:--');
            const alerts = ref([]);

            const metrics = reactive({
                criticalAlerts: 0,
                blockedIps: 0,
                successfulLogins: 0,
                totalRequests: 0,
                warningCount: 0
            });

            const threatIps = ref([]);

            // ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ë“¤
            const charts = {};

            // ì „ì—­ ë³€ìˆ˜
            let eventSource = null;
            let updateInterval = null;
            let reconnectAttempts = 0;
            const maxReconnectAttempts = 5;

            // SSE ì—°ê²° í•¨ìˆ˜
            function connectToAlertStream() {
                const token = localStorage.getItem('accessToken');

                const url = `/api/v1/admin/security/alerts/stream?token=${encodeURIComponent(token)}`;

                console.log('ğŸ”— SSE ì—°ê²° ì‹œë„:', url);

                connectionStatus.value = 'connecting';
                connectionStatusText.value = 'ğŸ”„ ì—°ê²° ì¤‘...';

                eventSource = new EventSource(url);

                eventSource.onopen = (event) => {
                    console.log('âœ… SSE ì—°ê²° ì„±ê³µ:', event);
                    connectionStatus.value = 'connected';
                    connectionStatusText.value = 'ğŸŸ¢ ì—°ê²°ë¨';
                    reconnectAttempts = 0;
                };

                eventSource.onmessage = (event) => {
                    console.log('ğŸ“¨ SSE ë©”ì‹œì§€ ìˆ˜ì‹ :', event.data);
                    try {
                        const data = JSON.parse(event.data);
                        if (data.type === 'SECURITY_ALERT') {
                            handleSecurityAlert(data);
                        }
                    } catch (e) {
                        console.log('ğŸ“‹ í…ìŠ¤íŠ¸ ë©”ì‹œì§€:', event.data);
                    }
                };

                eventSource.addEventListener('security_alert', (event) => {
                    console.log('ğŸš¨ ë³´ì•ˆ ì•Œë¦¼ ì´ë²¤íŠ¸:', event.data);
                    const alert = JSON.parse(event.data);
                    handleSecurityAlert(alert);
                });

                eventSource.addEventListener('connected', (event) => {
                    console.log('ğŸ‰ ì—°ê²° ì™„ë£Œ ì´ë²¤íŠ¸:', event.data);
                    connectionStatus.value = 'connected';
                    connectionStatusText.value = 'ğŸŸ¢ ì—°ê²°ë¨';
                });

                eventSource.onerror = (error) => {
                    console.error('âŒ SSE ì—°ê²° ì˜¤ë¥˜:', error);
                    connectionStatus.value = 'disconnected';
                    connectionStatusText.value = 'ğŸ”´ ì—°ê²° ëŠì–´ì§';

                    if (reconnectAttempts < maxReconnectAttempts) {
                        setTimeout(() => {
                            reconnectAttempts++;
                            console.log(`ğŸ”„ ì¬ì—°ê²° ì‹œë„ ${reconnectAttempts}/${maxReconnectAttempts}`);
                            connectToAlertStream();
                        }, 3000 * reconnectAttempts);
                    } else {
                        console.error('ğŸ’€ ìµœëŒ€ ì¬ì—°ê²° ì‹œë„ íšŸìˆ˜ ë„ë‹¬');
                    }
                };
            }

            // ë³´ì•ˆ ì•Œë¦¼ ì²˜ë¦¬
            function handleSecurityAlert(alert) {
                console.log('ğŸš¨ ë³´ì•ˆ ì•Œë¦¼ ì²˜ë¦¬:', alert);

                const newAlert = {
                    ...alert,
                    id: Date.now() + Math.random(),
                    timestamp: new Date()
                };

                alerts.value.push(newAlert);

                // ë¸Œë¼ìš°ì € ì•Œë¦¼
                if (Notification.permission === 'granted') {
                    new Notification(alert.title, {
                        body: alert.message,
                        icon: '/images/security-warning.png'
                    });
                }

                // ê¸´ê¸‰ ì•Œë¦¼ ì‹œ ì†Œë¦¬
                if (alert.severity === 'CRITICAL') {
                    playAlertSound();
                }

                // 15ì´ˆ í›„ ìë™ ì œê±°
                setTimeout(() => {
                    removeAlert(newAlert.id);
                }, 15000);
            }

            // ì•Œë¦¼ ì†Œë¦¬ ì¬ìƒ
            function playAlertSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
                } catch (error) {
                    console.warn('ì•Œë¦¼ ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:', error);
                }
            }

            // ìƒ‰ìƒ íŒ”ë ˆíŠ¸
            const colors = {
                primary: '#3498db',
                danger: '#e74c3c',
                warning: '#f39c12',
                success: '#27ae60',
                info: '#17a2b8',
                purple: '#9b59b6'
            };

            // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ
            onMounted(async () => {
                console.log('ğŸš€ Vue ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œì‘');

                const token = localStorage.getItem('accessToken');
                if (!token) {
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    window.location.href = '/login';
                    return;
                }

                // ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
                if (Notification.permission === 'default') {
                    const permission = await Notification.requestPermission();
                    console.log('ğŸ”” ì•Œë¦¼ ê¶Œí•œ:', permission);
                }

                await nextTick();
                console.log('ğŸ“Š ì°¨íŠ¸ ì´ˆê¸°í™” ì‹œì‘');
                initializeCharts();

                console.log('ğŸ”— SSE ì—°ê²° ì‹œì‘');
                connectToAlertStream();

                console.log('ğŸ”„ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹œì‘');
                startDataUpdates();

                console.log('âœ… Vue ì»´í¬ë„ŒíŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
            });

            // ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ
            onUnmounted(() => {
                console.log('ğŸ›‘ Vue ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸');

                if (eventSource) {
                    eventSource.close();
                    console.log('ğŸ”Œ SSE ì—°ê²° ì¢…ë£Œ');
                }
                if (updateInterval) {
                    clearInterval(updateInterval);
                    console.log('â° ì—…ë°ì´íŠ¸ ì¸í„°ë²Œ ì •ë¦¬');
                }
            });

            // ì°¨íŠ¸ ì´ˆê¸°í™”
            function initializeCharts() {
                console.log('ğŸ“Š ì°¨íŠ¸ ì´ˆê¸°í™” ì‹œì‘');

                try {
                    // 1. ì‹¤ì‹œê°„ ë³´ì•ˆ ì´ë²¤íŠ¸ ì¶”ì´
                    const ctx1 = document.getElementById('realTimeChart');
                    if (!ctx1) {
                        console.error('âŒ realTimeChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                        return;
                    }

                    charts.realTime = new Chart(ctx1.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: [
                                {
                                    label: 'ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²©',
                                    data: [],
                                    borderColor: colors.danger,
                                    backgroundColor: colors.danger + '20',
                                    tension: 0.4,
                                    fill: true
                                },
                                {
                                    label: 'DDoS ê³µê²©',
                                    data: [],
                                    borderColor: colors.warning,
                                    backgroundColor: colors.warning + '20',
                                    tension: 0.4,
                                    fill: true
                                },
                                {
                                    label: 'ìŠ¤ìºë‹ ì‹œë„',
                                    data: [],
                                    borderColor: colors.info,
                                    backgroundColor: colors.info + '20',
                                    tension: 0.4,
                                    fill: true
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {position: 'top'}
                            },
                            scales: {
                                y: {beginAtZero: true}
                            }
                        }
                    });

                    // 2. ì‹œê°„ëŒ€ë³„ íŒ¨í„´
                    const ctx3 = document.getElementById('hourlyChart');
                    if (!ctx3) {
                        console.error('âŒ hourlyChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                        return;
                    }
                    charts.hourly = new Chart(ctx3.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: Array.from({length: 24}, (_, i) => i.toString().padStart(2, '0') + ':00'),
                            datasets: [{
                                label: 'ê³µê²© ì‹œë„',
                                data: new Array(24).fill(0),
                                backgroundColor: colors.primary
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {beginAtZero: true}
                            }
                        }
                    });

                    // 3. ì‘ë‹µì‹œê°„ ëª¨ë‹ˆí„°ë§
                    const ctx4 = document.getElementById('responseTimeChart');
                    if (!ctx4) {
                        console.error('âŒ responseTimeChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                        return;
                    }
                    charts.responseTime = new Chart(ctx4.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: [
                                {
                                    label: 'í‰ê·  ì‘ë‹µì‹œê°„ (ms)',
                                    data: [],
                                    borderColor: colors.primary,
                                    backgroundColor: colors.primary + '20',
                                    tension: 0.4,
                                    fill: true
                                },
                                {
                                    label: 'ì„ê³„ê°’ (500ms)',
                                    data: [],
                                    borderColor: colors.danger,
                                    borderDash: [5, 5],
                                    pointRadius: 0,
                                    fill: false
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {beginAtZero: true}
                            }
                        }
                    });
                } catch (error) {
                    console.error('âŒ ì°¨íŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    alert('ì°¨íŠ¸ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ ì£¼ì„¸ìš”.');
                }
            }

            // ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹œì‘
            function startDataUpdates() {
                updateData(); // ì¦‰ì‹œ ì‹¤í–‰
                updateInterval = setInterval(updateData, 10000); // 10ì´ˆë§ˆë‹¤
            }

            // ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸ (ì‹¤ì œ API í˜¸ì¶œ)
            async function updateData() {
                const token = localStorage.getItem('accessToken');

                try {
                    // 1. ë³´ì•ˆ ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
                    const metricsResponse = await fetch(`/api/v1/admin/dashboard/metrics?timeRange=${selectedTimeRange.value}`, {
                        headers: {'Authorization': `Bearer ${token}`}
                    });

                    if (metricsResponse.ok) {
                        const metricsData = await metricsResponse.json();
                        if (metricsData.success) {
                            Object.assign(metrics, metricsData.data);
                        }
                    }

                    // 2. ìœ„í˜‘ IP ì—…ë°ì´íŠ¸
                    const threatsResponse = await fetch(`/api/v1/admin/dashboard/threats/top-ips?timeRange=${selectedTimeRange.value}`, {
                        headers: {'Authorization': `Bearer ${token}`}
                    });

                    if (threatsResponse.ok) {
                        const threatsData = await threatsResponse.json();
                        if (threatsData.success) {
                            threatIps.value = threatsData.data;
                        }
                    }

                    // 3. íƒ€ì„ë¼ì¸ ë°ì´í„° ì—…ë°ì´íŠ¸
                    const timelineResponse = await fetch(`/api/v1/admin/dashboard/events/timeline?timeRange=${selectedTimeRange.value}`, {
                        headers: {'Authorization': `Bearer ${token}`}
                    });

                    if (timelineResponse.ok) {
                        const timelineData = await timelineResponse.json();
                        if (timelineData.success) {
                            updateTimelineChart(timelineData.data);
                        }
                    }

                    // 4. ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ì—…ë°ì´íŠ¸
                    const hourlyResponse = await fetch('/api/v1/admin/dashboard/patterns/hourly', {
                        headers: {'Authorization': `Bearer ${token}`}
                    });

                    if (hourlyResponse.ok) {
                        const hourlyData = await hourlyResponse.json();
                        if (hourlyData.success) {
                            updateHourlyChart(hourlyData.data);
                        }
                    }

                    // 5. ì‘ë‹µì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸
                    const responseTimeResponse = await fetch(`/api/v1/admin/dashboard/performance/response-times?timeRange=${selectedTimeRange.value}`, {
                        headers: {'Authorization': `Bearer ${token}`}
                    });

                    if (responseTimeResponse.ok) {
                        const responseTimeData = await responseTimeResponse.json();
                        if (responseTimeData.success) {
                            updateResponseTimeChart(responseTimeData.data);
                        }
                    }

                } catch (error) {
                    console.warn('API í˜¸ì¶œ ì‹¤íŒ¨:', error);
                    // í´ë°± ë°ì´í„° ì‚¬ìš© ê°€ëŠ¥
                }

                lastUpdateTime.value = new Date().toLocaleTimeString();
            }

            // íƒ€ì„ë¼ì¸ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            function updateTimelineChart(data) {
                if (!charts.realTime || !data || data.length === 0) return;

                const labels = data.map(item => {
                    const date = new Date(item.timestamp);
                    return date.toLocaleTimeString();
                });

                const bruteforceData = data.map(item => item.bruteforceCount || 0);
                const ddosData = data.map(item => item.ddosCount || 0);
                const scanningData = data.map(item => item.scanningCount || 0);

                charts.realTime.data.labels = labels;
                charts.realTime.data.datasets[0].data = bruteforceData;
                charts.realTime.data.datasets[1].data = ddosData;
                charts.realTime.data.datasets[2].data = scanningData;

                charts.realTime.update('none');
            }

            // ì‹œê°„ëŒ€ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            function updateHourlyChart(data) {
                if (!charts.hourly || !data || data.length === 0) return;

                const hourlyData = new Array(24).fill(0);
                data.forEach(item => {
                    if (item.hour >= 0 && item.hour < 24) {
                        hourlyData[item.hour] = item.attackCount || 0;
                    }
                });

                charts.hourly.data.datasets[0].data = hourlyData;
                charts.hourly.update('none');
            }

            // ì‘ë‹µì‹œê°„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            function updateResponseTimeChart(data) {
                if (!charts.responseTime || !data || data.length === 0) return;

                const labels = data.map(item => {
                    const date = new Date(item.timestamp);
                    return date.toLocaleTimeString();
                });

                const responseTimeData = data.map(item => item.averageResponseTime || 0);
                const thresholdData = new Array(data.length).fill(500);

                charts.responseTime.data.labels = labels;
                charts.responseTime.data.datasets[0].data = responseTimeData;
                charts.responseTime.data.datasets[1].data = thresholdData;

                charts.responseTime.update('none');
            }

            // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
            function formatNumber(num) {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return num.toString();
            }

            function formatTime(timestamp) {
                return new Date(timestamp).toLocaleTimeString();
            }

            function getThreatColor(risk) {
                const colorMap = {
                    'CRITICAL': '#dc3545',
                    'HIGH': '#fd7e14',
                    'MEDIUM': '#ffc107',
                    'LOW': '#28a745'
                };
                return colorMap[risk] || '#6c757d';
            }

            // ì‚¬ìš©ì ì•¡ì…˜ í•¨ìˆ˜ë“¤
            function refreshAllData() {
                updateData();
                // ëª¨ë“  ì°¨íŠ¸ ìƒˆë¡œê³ ì¹¨
                Object.values(charts).forEach(chart => {
                    if (chart && typeof chart.update === 'function') {
                        chart.update();
                    }
                });
            }

            function updateTimeRange() {
                console.log(`ì‹œê°„ ë²”ìœ„ ë³€ê²½: ${selectedTimeRange.value}`);
                updateData();
            }

            async function testAlert() {
                const token = localStorage.getItem('accessToken');

                try {
                    const response = await fetch('/api/v1/admin/security/alerts/test', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        console.log('í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ');
                    }
                } catch (error) {
                    console.error('í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ì‹¤íŒ¨:', error);
                    // ì§ì ‘ í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ìƒì„±
                    handleSecurityAlert({
                        title: 'ğŸ§ª í…ŒìŠ¤íŠ¸ ë³´ì•ˆ ì•Œë¦¼',
                        message: 'ì´ê²ƒì€ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì•Œë¦¼ì…ë‹ˆë‹¤.\nëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™ì¤‘ì…ë‹ˆë‹¤.',
                        severity: 'MEDIUM',
                        alertKey: 'test-' + Date.now(),
                        ipAddress: '192.168.1.100'
                    });
                }
            }

            function exportReport() {
                console.log('ë¦¬í¬íŠ¸ ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ (êµ¬í˜„ ì˜ˆì •)');
                alert('ë¦¬í¬íŠ¸ ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ì´ ê³§ ì¶œì‹œë©ë‹ˆë‹¤!');
            }

            async function acknowledgeAlert(alert) {
                const token = localStorage.getItem('accessToken');

                try {
                    await fetch('/api/v1/admin/security/alerts/acknowledge', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({alertKey: alert.alertKey})
                    });

                    removeAlert(alert.id);
                    console.log('ì•Œë¦¼ í™•ì¸ ì²˜ë¦¬ë¨');
                } catch (error) {
                    console.error('ì•Œë¦¼ í™•ì¸ ì‹¤íŒ¨:', error);
                    removeAlert(alert.id);
                }
            }

            async function suppressAlert(alert, hours) {
                const token = localStorage.getItem('accessToken');

                try {
                    await fetch('/api/v1/admin/security/alerts/suppress', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            alertKey: alert.alertKey,
                            suppressHours: hours
                        })
                    });

                    removeAlert(alert.id);
                    console.log(`${hours}ì‹œê°„ ë™ì•ˆ ì•Œë¦¼ ì–µì œë¨`);
                } catch (error) {
                    console.error('ì•Œë¦¼ ì–µì œ ì‹¤íŒ¨:', error);
                    removeAlert(alert.id);
                }
            }

            function blockIp(ipAddress) {
                if (confirm(`IP ${ipAddress}ë¥¼ ì°¨ë‹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    console.log(`IP ì°¨ë‹¨ ìš”ì²­: ${ipAddress}`);
                    // ì‹¤ì œ IP ì°¨ë‹¨ API í˜¸ì¶œ
                    alert(`IP ${ipAddress} ì°¨ë‹¨ ìš”ì²­ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }
            }

            function removeAlert(alertId) {
                const index = alerts.value.findIndex(alert => alert.id === alertId);
                if (index > -1) {
                    alerts.value.splice(index, 1);
                }
            }

            // í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©í•  í•¨ìˆ˜ë“¤ ë°˜í™˜
            return {
                // ë°˜ì‘í˜• ë°ì´í„°
                connectionStatus,
                connectionStatusText,
                selectedTimeRange,
                lastUpdateTime,
                alerts,
                metrics,
                threatIps,

                // í•¨ìˆ˜ë“¤
                formatNumber,
                formatTime,
                getThreatColor,
                refreshAllData,
                updateTimeRange,
                testAlert,
                exportReport,
                acknowledgeAlert,
                suppressAlert,
                blockIp,
                removeAlert
            };

        }
    }).mount('#app');
</script>
</body>
</html>